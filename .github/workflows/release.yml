name: CD

on: [push]

jobs:
  build:

    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os:
          - ubuntu-latest
          - windows-latest

    steps:
    - uses: actions/checkout@v4
    - uses: actions/cache@v4
      with:
        path: ~/.m2/repository
        key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
        restore-keys: ${{ runner.os }}-maven-
    - name: Set up Graalvm
      uses: graalvm/setup-graalvm@v1.2.1
      with:
        # Java version. See examples of supported syntax in the README file.
        java-version: 21
        distribution: graalvm-community
        components: native-image
        cache: maven
        version: latst
    - name: Build with Maven
      run: mvn -Pnative -DskipTests
    - name: Upload release assets
      uses: actions/upload-release-asset@v1
      with:
        upload_url: ${{ github.event.release.upload_url }}
        asset_path: target/pom
        asset_name: pom-${{ matrix.os }}
        asset_content_type: application/octet-stream
